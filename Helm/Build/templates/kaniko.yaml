apiVersion: v1
kind: Pod
metadata:
  name: {{ .Release.Name }}-kaniko
spec:
  containers:
  - name: kaniko
    image: gcr.io/kaniko-project/executor:latest
    args:
    - "--dockerfile=Dockerfile"
    - "--context={{ .Values.context }}"
    - "--destination=benkenobi3/{{ .Values.image }}:{{ .Values.tag }}"
    volumeMounts:
    - name: config-json
      mountPath: /kaniko/.docker/
      readOnly: true
  volumes:
    - name: config-json
      secret:
        secretName: {{ .Release.Name }}-secret
        optional: false

  restartPolicy: Never
